<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="utf-8">
    <title>Cricket Yoddha - GitHub Fix</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://cdn.plyr.io/3.7.8/plyr.css" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/shaka-player/4.3.5/shaka-player.compiled.js"></script>
    <style>
        body { margin: 0; background: #000; height: 100vh; display: flex; align-items: center; justify-content: center; }
        .container { width: 100%; max-width: 1000px; aspect-ratio: 16/9; }
        video { width: 100%; height: 100%; }
    </style>
</head>
<body>

<div class="container">
    <video id="player" playsinline controls></video>
</div>

<script src="https://cdn.plyr.io/3.7.8/plyr.polyfilled.js"></script>

<script>
async function startPlayer() {
    const video = document.getElementById('player');
    shaka.polyfill.installAll();

    if (!shaka.Player.isBrowserSupported()) {
        alert("Browser not supported!");
        return;
    }

    const shakaInstance = new shaka.Player(video);

    // GitHub par CORS issues ke liye ye header kabhi kabhi kaam kar jata hai
    shakaInstance.configure({
        drm: {
            clearKeys: {
                'ae7076b647133606b704d33e4cef5134': '810251515584cf71216d9a2d1ebf04bb'
            }
        },
        manifest: {
            dash: {
                ignoreMinBufferTime: true
            }
        }
    });

    const url = 'https://livem-d-01-icc-we.akamaized.net/variant/v1/dai-event-prd-pal-west/vcg-01-d/DASH_DASH/Live/channel(vcg-01-ch-hd-05)/manifest.mpd?vcfilter=44951f97-10ec-427f-a95a-a2ecf57e9a41';

    try {
        await shakaInstance.load(url);
        console.log("Success!");
        
        // Quality menu setup
        const tracks = shakaInstance.getVariantTracks();
        const levels = [...new Set(tracks.map(t => t.height))].filter(h => h).sort((a,b)=>b-a);

        new Plyr(video, {
            settings: ['quality'],
            quality: {
                options: [0, ...levels],
                onChange: (h) => {
                    if(h===0) shakaInstance.configure({abr:{enabled:true}});
                    else {
                        shakaInstance.configure({abr:{enabled:false}});
                        shakaInstance.selectVariantTrack(tracks.find(t=>t.height===h), true);
                    }
                }
            }
        });

    } catch (e) {
        // Agar GitHub par fail ho raha hai toh yahan alert aayega
        alert("Error Code: " + e.code + " - GitHub may be blocking the stream.");
        console.error("Error Detail:", e);
    }
}

document.addEventListener('DOMContentLoaded', startPlayer);
</script>
</body>
</html>
